<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>front/js/modules/request.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Game.html">Game</a></span></li><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="AppRequest.html">AppRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppRequest.html#.connectAccount">connectAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppRequest.html#.deleteAccount">deleteAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppRequest.html#.registerAccount">registerAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppRequest.html#.sendHome">sendHome</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppRequest.html#.sendProfile">sendProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppRequest.html#.sendRules">sendRules</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppRequest.html#.sendScores">sendScores</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Canvas.html">Canvas</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Canvas.html#.drawCanvas">drawCanvas</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Canvas.html#.firstSetup">firstSetup</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Canvas.html#.getCursorPosition">getCursorPosition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Canvas.html#.resizeCanvas">resizeCanvas</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Database.html">Database</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#.delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#.find">find</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#.login">login</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#.register">register</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Request.html">Request</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Request.html#.sendDelete">sendDelete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Request.html#.sendLogin">sendLogin</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Request.html#.sendRegister">sendRegister</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Scenes.html">Scenes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scenes.html#.clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scenes.html#.startMenu">startMenu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scenes.html#.waitingMenu">waitingMenu</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Scores.html">Scores</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scores.html#.getRankData">getRankData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scores.html#.getRankInfos">getRankInfos</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scores.html#.getRankLine">getRankLine</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Storage.html">Storage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Storage.html#.editData">editData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Storage.html#.editData">editData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Storage.html#.getData">getData</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Stratego.html">Stratego</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stratego.html#.endGame">endGame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stratego.html#.saveGame">saveGame</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="TableDraw.html">TableDraw</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Toast.html">Toast</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Toast.html#.error">error</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Toast.html#.error">error</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Toast.html#.error">error</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#io">io</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#port">port</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#server">server</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">front/js/modules/request.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Send XMLHTTPRequests to the server to get results from the database
 * @version 1.0
 * @author Stratego Online
 */

/**
 * POST and GET requests sent by users
 * @type {Object}
 * @return {Object} functions to use with the Request module
 * @name Request
 * @namespace Request
 */
let Request = (function () {
  /**
   * @function Request.sendLogin
   * @param {string} email
   * user's email used to login
   * @param {string} password
   * user's password used to login
   * @returns {} /
   * @description Login XMLHTTPRequest to send to the express app, the XHR content is sent as a POST request
   */
  function sendLoginXHR(email, password) {
    //TODO display an error
    if (email === undefined || password === undefined) return;

    let XHR = new XMLHttpRequest();
    // XHR ERROR HANDLING
    XHR.addEventListener("load", () => {
      //console.log(`Data loaded: ${XHR.status} ${XHR.response}`);
    });
    XHR.addEventListener("error", () => {
      //console.log("An error occurred while sending the request...");
    });
    XHR.addEventListener("abort", () => {
      //console.log("The transfer has been canceled by the user.");
    });

    XHR.open("POST", "/");
    XHR.setRequestHeader("Content-Type", "application/json");
    XHR.responseType = "json";
    XHR.send(JSON.stringify({ email: email, password: password }));
  }

  //======================================================================================
  /**
   * @function Request.sendRegister
   * @param {string} email
   * user's email to set
   * @param {string} password
   * user's password to set
   * @param {string} password2
   * test to verify the user hasn't made a mistake while writing his password
   * @param {string} username
   * user's username to display in game and in his profile
   * @returns {} /
   * @description Register XMLHTTPRequest to send to the express app, the XHR content is sent as a POST request
   */
  function sendRegisterXHR(email, password, password2, username) {
    //TODO display an error
    if (
      password != password2 ||
      email === undefined ||
      password === undefined ||
      username === undefined
    )
      return;

    let XHR = new XMLHttpRequest();
    // XHR ERROR HANDLING
    XHR.addEventListener("load", () => {
      //console.log(`Data loaded: ${XHR.status} ${XHR.response}`);
    });
    XHR.addEventListener("error", () => {
      Toast.error("An error occurred during your registration...");
    });
    XHR.addEventListener("abort", () => {
      Toast.error("Your account deletion has been canceled...");
    });

    XHR.open("POST", "/");
    XHR.setRequestHeader("Content-Type", "application/json");
    XHR.responseType = "json";
    XHR.send(
      JSON.stringify({
        email: email,
        password: password,
        username: username,
        password2: password2,
      })
    );
  }

  //======================================================================================
  /**
   * @function Request.sendDelete
   * @param {string} email
   * user's email to find the user to delete in the database
   * @param {string} username
   * using the email would be fine since it is supposed to be unique but adding the username is a security
   * @returns {} /
   * @description Delete XMLHTTPRequest to send to the express app, the XHR content is sent as a POST request
   */
  function sendDeleteXHR(email, username) {
    //The email would be enough to delete an account since it is unique but we also use the username just to be sure
    //TODO display an error
    if (email === undefined || username === undefined) return;

    let XHR = new XMLHttpRequest();
    // XHR ERROR HANDLING
    XHR.addEventListener("load", () => {
      //console.log(`Data loaded: ${XHR.status} ${XHR.response}`);
    });
    XHR.addEventListener("error", () => {
      Toast.error("An error occurred during your account deletion...");
    });
    XHR.addEventListener("abort", () => {
      Toast.error("Your account deletion has been canceled...");
    });

    XHR.onreadystatechange = () => {
      if (XHR.readyState === 4 &amp;&amp; XHR.status === 200) {
        if (typeof XHR.response.redirect == "string") {
          window.location.replace(XHR.response.redirect);

          Toast.success("Your account has been successfully deleted");
        } else if (typeof XHR.response.error == "string") {
          Toast.error(XHR.response.error);
        }
      }
    };

    XHR.open("POST", "/profile/");
    XHR.setRequestHeader("Content-Type", "application/json");
    //XHR.responseType = "json";
    XHR.send(JSON.stringify({ login: email, username: username }));
  }

  //return Object
  return {
    sendLogin(email, password) {
      sendLoginXHR(email, password);
    },
    sendRegister(email, password, password2, username) {
      sendRegisterXHR(email, password, password2, username);
    },
    sendDelete(email, username) {
      sendDeleteXHR(email, username);
    },
  };
})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Fri Mar 12 2021 01:18:48 GMT+0100 (Central European Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
